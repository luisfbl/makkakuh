<div class="achievement-management" *ngIf="isAdmin">
    <div class="management-header">
        <h3>🏆 Gerenciar Conquistas</h3>
        <button
            class="btn btn-primary"
            (click)="openCreateModal()"
            [disabled]="loading"
        >
            <span class="icon-plus"></span>
            Nova Conquista
        </button>
    </div>

    <div class="error-message" *ngIf="error">
        {{ error }}
    </div>

    <div class="loading-spinner" *ngIf="loading && achievements.length === 0">
        🔄 Carregando conquistas...
    </div>

    <div class="achievements-showcase" *ngIf="achievements.length > 0">
        <h2 class="showcase-title">
            <span class="title-icon">🏅</span>
            Conquistas Disponíveis
            <span class="total-count">{{ achievements.length }}</span>
        </h2>

        <!-- Legiões -->
        <div
            class="category-section legion-section"
            *ngIf="getLegionAchievements().length > 0"
        >
            <div class="category-header">
                <div class="header-left">
                    <span class="category-icon">⚔️</span>
                    <h4 class="category-title">Legiões</h4>
                    <span class="category-count">{{
                        getLegionAchievements().length
                    }}</span>
                </div>
                <div class="category-description">
                    Organizações e facções dos guerreiros
                </div>
            </div>
            <div class="category-grid">
                <div
                    class="achievement-card"
                    *ngFor="let achievement of getLegionAchievements()"
                >
                    <div class="badge-container">
                        <app-achievement-badge
                            [achievement]="achievement"
                            size="medium"
                            [showName]="false"
                        >
                        </app-achievement-badge>
                    </div>
                    <div class="achievement-info">
                        <h5 class="achievement-name">{{ achievement.name }}</h5>
                        <p
                            class="achievement-desc"
                            *ngIf="achievement.description"
                        >
                            {{ achievement.description }}
                        </p>
                    </div>
                    <div class="achievement-actions">
                        <button
                            class="btn-icon edit"
                            (click)="openEditModal(achievement)"
                            [disabled]="loading"
                            title="Editar conquista"
                        >
                            ✏️
                        </button>
                        <button
                            class="btn-icon delete"
                            (click)="deleteAchievement(achievement)"
                            [disabled]="loading"
                            title="Excluir conquista"
                        >
                            🗑️
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feitos e Honrarias -->
        <div
            class="category-section honors-section"
            *ngIf="getFeatsAndHonorsAchievements().length > 0"
        >
            <div class="category-header">
                <div class="header-left">
                    <span class="category-icon">🏅</span>
                    <h4 class="category-title">Feitos e Honrarias</h4>
                    <span class="category-count">{{
                        getFeatsAndHonorsAchievements().length
                    }}</span>
                </div>
                <div class="category-description">
                    Conquistas e reconhecimentos especiais
                </div>
            </div>
            <div class="category-grid">
                <div
                    class="achievement-card"
                    *ngFor="let achievement of getFeatsAndHonorsAchievements()"
                >
                    <div class="badge-container">
                        <app-achievement-badge
                            [achievement]="achievement"
                            size="medium"
                            [showName]="false"
                        >
                        </app-achievement-badge>
                    </div>
                    <div class="achievement-info">
                        <h5 class="achievement-name">{{ achievement.name }}</h5>
                        <p
                            class="achievement-desc"
                            *ngIf="achievement.description"
                        >
                            {{ achievement.description }}
                        </p>
                    </div>
                    <div class="achievement-actions">
                        <button
                            class="btn-icon edit"
                            (click)="openEditModal(achievement)"
                            [disabled]="loading"
                            title="Editar conquista"
                        >
                            ✏️
                        </button>
                        <button
                            class="btn-icon delete"
                            (click)="deleteAchievement(achievement)"
                            [disabled]="loading"
                            title="Excluir conquista"
                        >
                            🗑️
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Patentes -->
        <div
            class="category-section ranks-section"
            *ngIf="getRankAchievements().length > 0"
        >
            <div class="category-header">
                <div class="header-left">
                    <span class="category-icon">🎖️</span>
                    <h4 class="category-title">Patentes</h4>
                    <span class="category-count">{{
                        getRankAchievements().length
                    }}</span>
                </div>
                <div class="category-description">
                    Hierarquias e ranks militares (molduras de avatar)
                </div>
            </div>
            <div class="category-grid">
                <div
                    class="achievement-card"
                    *ngFor="let achievement of getRankAchievements()"
                >
                    <div class="badge-container">
                        <app-achievement-badge
                            [achievement]="achievement"
                            size="medium"
                            [showName]="false"
                        >
                        </app-achievement-badge>
                        <div class="frame-indicator" title="Moldura de avatar">
                            🖼️
                        </div>
                    </div>
                    <div class="achievement-info">
                        <h5 class="achievement-name">{{ achievement.name }}</h5>
                        <p
                            class="achievement-desc"
                            *ngIf="achievement.description"
                        >
                            {{ achievement.description }}
                        </p>
                    </div>
                    <div class="achievement-actions">
                        <button
                            class="btn-icon edit"
                            (click)="openEditModal(achievement)"
                            [disabled]="loading"
                            title="Editar conquista"
                        >
                            ✏️
                        </button>
                        <button
                            class="btn-icon delete"
                            (click)="deleteAchievement(achievement)"
                            [disabled]="loading"
                            title="Excluir conquista"
                        >
                            🗑️
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="empty-state" *ngIf="!loading && achievements.length === 0">
        <div class="empty-icon">🏆</div>
        <p>Nenhuma conquista cadastrada ainda.</p>
        <button class="btn btn-primary" (click)="openCreateModal()">
            Criar primeira conquista
        </button>
    </div>
</div>

<!-- Create Modal -->
<app-generic-modal
    *ngIf="showCreateModal"
    title="Nova Conquista"
    size="medium"
    [buttons]="createModalButtons"
    (modalClosed)="closeModals()"
>
    <ng-template #modalBody>
        <form [formGroup]="achievementForm" class="achievement-form">
            <div class="error-message" *ngIf="error">
                {{ error }}
            </div>

            <div class="form-group">
                <label for="name">Nome da Conquista *</label>
                <input
                    type="text"
                    id="name"
                    formControlName="name"
                    class="form-control"
                    [class.is-invalid]="getFieldError('name')"
                    placeholder="Ex: Veterano de Guerra"
                />
                <div class="invalid-feedback" *ngIf="getFieldError('name')">
                    {{ getFieldError("name") }}
                </div>
            </div>

            <div class="form-group">
                <label for="description">Descrição</label>
                <textarea
                    id="description"
                    formControlName="description"
                    class="form-control"
                    rows="3"
                    placeholder="Descreva o que esta conquista representa..."
                ></textarea>
                <small class="form-hint">
                    Uma breve descrição do significado da conquista
                </small>
            </div>

            <div class="form-group">
                <label for="category">Categoria *</label>
                <select
                    id="category"
                    formControlName="category"
                    class="form-control"
                >
                    <option
                        *ngFor="let cat of achievementCategories"
                        [value]="cat.value"
                    >
                        {{ cat.label }}
                    </option>
                </select>
                <small class="form-hint">
                    Patentes automaticamente viram molduras de avatar
                </small>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="order">Ordem de Exibição</label>
                    <input
                        type="number"
                        id="order"
                        formControlName="order"
                        class="form-control"
                        min="0"
                        placeholder="0"
                    />
                    <small class="form-hint">
                        Ordem para organizar as conquistas
                    </small>
                </div>

                <div class="form-group">
                    <label for="color">Cor do Badge</label>
                    <input
                        type="color"
                        id="color"
                        formControlName="color"
                        class="form-control"
                        value="#FFD700"
                    />
                    <small class="form-hint">
                        Cor de destaque da conquista
                    </small>
                </div>
            </div>

            <div class="form-group">
                <label>Ícone da Conquista</label>
                <app-image-upload
                    variant="compact"
                    size="small"
                    type="honor"
                    buttonText="Selecionar Ícone"
                    placeholderText="Clique para selecionar o ícone"
                    [showInstructions]="false"
                    [allowRemove]="true"
                    (imageUploaded)="onIconUploaded($event)"
                    (uploadError)="onUploadError($event)"
                >
                </app-image-upload>
                <small class="form-hint">
                    PNG, JPG, SVG ou GIF. Tamanho recomendado: 64x64px
                </small>
            </div>
        </form>
    </ng-template>
</app-generic-modal>

<!-- Edit Modal -->
<app-generic-modal
    *ngIf="showEditModal"
    title="✏️ Editar Conquista"
    size="medium"
    [buttons]="editModalButtons"
    (modalClosed)="closeModals()"
>
    <ng-template #modalBody>
        <form [formGroup]="achievementForm" class="achievement-form">
            <div class="error-message" *ngIf="error">
                {{ error }}
            </div>

            <div class="current-achievement" *ngIf="selectedAchievement">
                <label>Conquista Atual:</label>
                <app-achievement-badge
                    [achievement]="selectedAchievement"
                    size="small"
                    [showName]="true"
                >
                </app-achievement-badge>
            </div>

            <div class="form-group">
                <label for="edit-name">Nome da Conquista *</label>
                <input
                    type="text"
                    id="edit-name"
                    formControlName="name"
                    class="form-control"
                    [class.is-invalid]="getFieldError('name')"
                    placeholder="Ex: Veterano de Guerra"
                />
                <div class="invalid-feedback" *ngIf="getFieldError('name')">
                    {{ getFieldError("name") }}
                </div>
            </div>

            <div class="form-group">
                <label for="edit-description">Descrição</label>
                <textarea
                    id="edit-description"
                    formControlName="description"
                    class="form-control"
                    rows="3"
                    placeholder="Descreva o que esta conquista representa..."
                ></textarea>
                <small class="form-hint">
                    Uma breve descrição do significado da conquista
                </small>
            </div>

            <div class="form-group">
                <label for="edit-category">Categoria *</label>
                <select
                    id="edit-category"
                    formControlName="category"
                    class="form-control"
                >
                    <option
                        *ngFor="let cat of achievementCategories"
                        [value]="cat.value"
                    >
                        {{ cat.label }}
                    </option>
                </select>
                <small class="form-hint">
                    Patentes automaticamente viram molduras de avatar
                </small>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="edit-order">Ordem de Exibição</label>
                    <input
                        type="number"
                        id="edit-order"
                        formControlName="order"
                        class="form-control"
                        min="0"
                        placeholder="0"
                    />
                    <small class="form-hint">
                        Ordem para organizar as conquistas
                    </small>
                </div>

                <div class="form-group">
                    <label for="edit-color">Cor do Badge</label>
                    <input
                        type="color"
                        id="edit-color"
                        formControlName="color"
                        class="form-control"
                    />
                    <small class="form-hint">
                        Cor de destaque da conquista
                    </small>
                </div>
            </div>

            <div class="form-group">
                <label>Novo Ícone (opcional)</label>
                <app-image-upload
                    variant="compact"
                    size="small"
                    type="honor"
                    buttonText="Alterar Ícone"
                    placeholderText="Clique para alterar o ícone"
                    [showInstructions]="false"
                    [allowRemove]="true"
                    [currentImage]="selectedAchievement?.icon ?? null"
                    (imageUploaded)="onIconUploaded($event)"
                    (uploadError)="onUploadError($event)"
                >
                </app-image-upload>
                <small class="form-hint">
                    Deixe em branco para manter o ícone atual. PNG, JPG, SVG ou
                    GIF
                </small>
            </div>
        </form>
    </ng-template>
</app-generic-modal>
